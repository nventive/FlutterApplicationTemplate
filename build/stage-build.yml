parameters:
- name: applicationEnvironment
  type: string
  default: ''
- name: artifactName
  type: string
  default: $(TestsArtifactName)_$(applicationEnvironment)
- name: androidArtifactName
  type: string
  default: $(AndroidArtifactName)_$(applicationEnvironment)
- name: iosArtifactName
  type: string
  default: $(iOSArtifactName)_$(applicationEnvironment)
- name: androidKeyStoreFile
  type: string
  default: ''
- name: androidKeyPropertiesFile
  type: string
  default: ''
- name: androidVariableGroup
  type: string
  default: ''
- name: iosCertificateFile
  type: string
  default: ''
- name: iosProvisioningProfileFile
  type: string
  default: ''
- name: iosExportOptionsFile
  type: string
  default: ''
- name: iosCertificatePassword
  type: string
  default: ''
- name: iosVariableGroup
  type: string
  default: ''
- name: removeHyperlinksFromReleaseNotes
  type: boolean
  default: false
- name: releaseNotesArtifactName
  type: string
  default: $(ReleaseNotesArtifactName)_$(applicationEnvironment)
- name: pathToSrc
  type: string
  default: '$(Build.SourcesDirectory)/src'
- name: projectName
  type: string
  default: ''
- name: BannerVersionNameText
  type: string
  default: ''
- name: firebaseJsonFile
  type: string
- name: firebaseOptionsDartFile
  type: string
- name: googleServicesJsonFile
  type: string
- name: bugseeVariableGroup
  type: string
  default: ''
- name: androidArtifactFormat
  type: string
  default: 'aab'

jobs:
  - job: OnMac_iOS
    pool:
      name: 'macOS-2023'
    variables:
    - name: ApplicationEnvironment
      value: ${{ parameters.applicationEnvironment }}
    - name: ArtifactName
      value: ${{ parameters.iosArtifactName }}

    - group: ${{ parameters.iosVariableGroup }}

    steps:
    - template: steps-build-ios.yml
      parameters:
        pathToSrc: ${{ parameters.pathToSrc }}
        projectName: ${{ parameters.projectName }}
        iosCertificateFile: ${{ parameters.iosCertificateFile }}
        iosCertificatePassword: ${{ parameters.iosCertificatePassword }}
        iosProvisioningProfileFile: ${{ parameters.iosProvisioningProfileFile }}
        iosExportOptionsFile: ${{ parameters.iosExportOptionsFile }}
        BannerVersionNameText: ${{ parameters.BannerVersionNameText }}
        firebaseJsonFile: '${{ parameters.firebaseJsonFile }}'
        firebaseOptionsDartFile: '${{ parameters.firebaseOptionsDartFile }}'
        googleServicesJsonFile: '${{ parameters.googleServicesJsonFile }}'

  - job: OnMac_iOS_Hosted
    pool:
      vmImage: 'macOS-15'
    variables:
    - name: ApplicationEnvironment
      value: ${{ parameters.applicationEnvironment }}
    - name: ArtifactName
      value: ${{ parameters.iosArtifactName }}

    - group: ${{ parameters.iosVariableGroup }}

    steps:
    - template: steps-build-ios.yml
      parameters:
        pathToSrc: ${{ parameters.pathToSrc }}
        projectName: ${{ parameters.projectName }}
        iosCertificateFile: ${{ parameters.iosCertificateFile }}
        iosCertificatePassword: ${{ parameters.iosCertificatePassword }}
        iosProvisioningProfileFile: ${{ parameters.iosProvisioningProfileFile }}
        iosExportOptionsFile: ${{ parameters.iosExportOptionsFile }}
        BannerVersionNameText: ${{ parameters.BannerVersionNameText }}
        firebaseJsonFile: '${{ parameters.firebaseJsonFile }}'
        firebaseOptionsDartFile: '${{ parameters.firebaseOptionsDartFile }}'
        googleServicesJsonFile: '${{ parameters.googleServicesJsonFile }}'